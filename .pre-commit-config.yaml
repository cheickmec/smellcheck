repos:
  - repo: local
    hooks:
      - id: no-commit-to-main
        name: no-commit-to-main
        entry: bash -c 'branch=$(git rev-parse --abbrev-ref HEAD); if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then echo "Direct commits to $branch are not allowed. Use a feature branch." >&2; exit 1; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

      - id: no-commit-to-merged-branch
        name: no-commit-to-merged-branch
        entry: bash scripts/check-merged-branch.sh
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

      - id: no-push-to-main
        name: no-push-to-main
        entry: bash -c 'branch=$(git rev-parse --abbrev-ref HEAD); if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then echo "Direct push to $branch is not allowed. Use a feature branch and open a PR." >&2; exit 1; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]

      - id: version-parity
        name: version-parity
        entry: python3 -m pytest tests/test_version_parity.py -q --no-header --tb=short
        language: system
        pass_filenames: false
        files: '(pyproject\.toml|\.release-please-manifest\.json|marketplace\.json)$'

      - id: doc-alignment
        name: doc-alignment
        entry: python3 scripts/check-doc-alignment.py
        language: system
        pass_filenames: false
        files: '(detector\.py|README\.md)$'

      - id: doc-staleness-reminder
        name: Remind about doc updates
        entry: bash scripts/check-docs-reminder.sh
        language: system
        files: ^src/
        types: [python]
        pass_filenames: false
        always_run: false
        verbose: true
