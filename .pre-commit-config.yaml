repos:
  - repo: local
    hooks:
      - id: no-commit-to-main
        name: no-commit-to-main
        entry: bash -c 'branch=$(git rev-parse --abbrev-ref HEAD); if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then echo "Direct commits to $branch are not allowed. Use a feature branch." >&2; exit 1; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

      - id: no-commit-to-merged-branch
        name: no-commit-to-merged-branch
        entry: bash scripts/check-merged-branch.sh
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

      - id: no-push-to-main
        name: no-push-to-main
        entry: bash -c 'branch=$(git rev-parse --abbrev-ref HEAD); if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then echo "Direct push to $branch is not allowed. Use a feature branch and open a PR." >&2; exit 1; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]

      - id: pr-description-reminder
        name: Remind about PR description
        entry: bash scripts/check-pr-description-reminder.sh
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]
        verbose: true

      - id: version-parity
        name: version-parity
        entry: python3 -m pytest tests/test_version_parity.py -q --no-header --tb=short
        language: system
        pass_filenames: false
        files: '(pyproject\.toml|\.release-please-manifest\.json|marketplace\.json)$'

      - id: vendor-sync
        name: auto-vendor smellcheck on detector.py change
        language: system
        entry: scripts/check-vendor-sync.sh
        files: ^src/smellcheck/detector\.py$
        stages: [pre-commit]
        pass_filenames: false

      - id: readme-links
        name: check README links are absolute and valid
        entry: python3 scripts/check-readme-links.py
        language: system
        pass_filenames: false
        files: ^README\.md$
        stages: [pre-commit]

      - id: doc-alignment
        name: doc-alignment
        entry: python3 scripts/check-doc-alignment.py
        language: system
        pass_filenames: false
        files: '(detector\.py|README\.md)$'

      - id: doc-staleness-reminder
        name: Remind about doc updates
        entry: bash scripts/check-docs-reminder.sh
        language: system
        files: ^src/
        types: [python]
        pass_filenames: false
        always_run: false
        verbose: true

      - id: check-commit-msg
        name: Validate conventional commit message
        entry: bash scripts/check-commit-msg.sh
        language: system
        stages: [commit-msg]
        always_run: true

      - id: breaking-change-reminder
        name: Remind about breaking changes
        entry: bash scripts/check-breaking-change-reminder.sh
        language: system
        stages: [commit-msg]
        always_run: true
        verbose: true
